// ===== TRANSLATIONS =====
const translations = {
    ar: {
        // Navigation
        home: "الرئيسية",
        about: "عنّي",
        skills: "المهارات",
        projects: "المشاريع",
        contact: "اتصل بي",

        // Hero Section
        welcome: "مرحباً بك في بورتفوليو",
        iam: "أنا",
        name: " جمانه مصطفى",
        title: "مهندسة Front-end Web محترفه",
        heroDesc: " أحب تحويل الأفكار إلى واقع ملموس, مع التركيز على تجربة المستخدم المتميزة والأداء العالي.",
        viewProjects: "عرض المشاريع",
        contactMe: "تواصل معي",
        projectsCompleted: "مشروع مكتمل",
        yearsExperience: "سنوات خبرة",


        // About Section
        aboutTitle: "عنّي",

        aboutBioTitle: "مرحباً، أنا جمانه",
        aboutBio1: "مهندس Front-end Web محترف مع أكثر من 2 سنوات من الخبرة في تطوير المواقع والتطبيقات الويب. لدي شغف كبير بإنشاء مواقع جميلة وعملية تلبي احتياجات المستخدمين.",
        aboutBio2: "متخصص في تطوير المواقع والتطبيقات الويب باستخدام React, Next.js, HTML, CSS و JavaScript، مع التركيز على واجهات المستخدم التفاعلية وتجربة المستخدم المتميزة والأداء العالي.",
        yearsExp: "سنوات خبرة",
        feature1Title: "مواقع سريعة",
        feature1Desc: "أداء عالي وتجربة مستخدم سلسة",
        feature2Title: "تصميم حديث",
        feature2Desc: "واجهات مستخدم جذابة وعصرية",
        feature3Title: "كود نظيف",
        feature3Desc: "هيكلة برمجية محترفة وقابلة للصيانة",

        // Skills Section
        skillsTitle: "المهارات",
        skillsSubtitle: "المهارات والتقنيات التي أتقنها",
        techSkills: "المهارات التقنية",
        uiSkills: "واجهة المستخدم",

        // Projects Section
        projectsTitle: "المشاريع",
        projectsSubtitle: "أحدث أعمالي وإنجازاتي",
        project1Title: "موقع متجر إلكتروني",
        project1Desc: "موقع متجر شامل للتجارة الإلكترونية مع دفع آمن وإدارة طلبات.",
        project2Title: "موقع طبي",
        project2Desc: "موقع لحجز المواعيد الطبية وإدارة السجلات الصحية.",
        project3Title: "موقع توصيل طعام",
        project3Desc: "موقع لتوصيل الطعام مع نظام تتبع حي للطلبات.",

        // Contact Section
        contactTitle: "اتصل بي",
        contactSubtitle: "لنتحدث عن مشروعك القادم",
        contactInfoTitle: "لنتحدث عن مشروعك",
        contactInfoDesc: "أنا متاح دائمًا لمناقشة أفكار مشاريعك ومساعدتك في تحقيقها. لا تتردد في التواصل معي عبر أي من الوسائل التالية.",
        emailTitle: "البريد الإلكتروني",
        phoneTitle: "الهاتف",
        locationTitle: "الموقع",
        location: "القاهرة، مصر",
        namePlaceholder: "الاسم الكامل",
        emailPlaceholder: "البريد الإلكتروني",
        subjectPlaceholder: "الموضوع",
        messagePlaceholder: "الرسالة",
        sendMessage: "إرسال الرسالة",

        // Footer
        footerText: "مهندس Front-end Web محترف متخصص في تطوير المواقع والتطبيقات الويب المبتكرة والعصرية.",
        allRights: "جميع الحقوق محفوظة"
    },
    en: {
        // Navigation
        home: "Home",
        about: "About",
        skills: "Skills",
        projects: "Projects",
        contact: "Contact",

        // Hero Section
        welcome: "Welcome to Portfolio",
        iam: "I'm",
        name: "Jomanah Mostafa",
        title: "Professional Front-end Engineer",
        heroDesc: "I develop innovative websites, focusing on exceptional user experience and high performance. I love turning ideas into tangible reality.",
        viewProjects: "View Projects",
        contactMe: "Contact Me",
        projectsCompleted: "Projects Completed",
        yearsExperience: "Years Experience",


        // About Section
        aboutTitle: "About Me",
        aboutSubtitle: "Learn more about my journey and expertise",
        aboutBioTitle: "Hello, I'm Jomanah",
        aboutBio1: "Professional Front-end engineer with over 2 years of experience in web applications development. I have a great passion for creating beautiful and practical applications that meet user needs.",
        aboutBio2: "Specialized in developing websites using html , css , javascrpt , react(next.js), with a focus on interactive user interfaces, exceptional user experience, and high performance.",
        yearsExp: "Years Experience",
        feature1Title: "Fast websites",
        feature1Desc: "High performance and smooth user experience",
        feature2Title: "Modern Design",
        feature2Desc: "Attractive and contemporary user interfaces",
        feature3Title: "Clean Code",
        feature3Desc: "Professional and maintainable software structure",

        // Skills Section
        skillsTitle: "Skills",
        skillsSubtitle: "Technologies and skills I master",
        techSkills: "Technical Skills",
        uiSkills: "User Interface",

        // Projects Section
        projectsTitle: "Projects",
        projectsSubtitle: "My latest works and achievements",
        project1Title: "E-commerce App",
        project1Desc: "Comprehensive e-commerce store application with secure payment and order management.",
        project2Title: "Medical App",
        project2Desc: "Application for booking medical appointments and managing health records.",
        project3Title: "Food Delivery App",
        project3Desc: "Food delivery application with live order tracking system.",

        // Contact Section
        contactTitle: "Contact Me",
        contactSubtitle: "Let's talk about your next project",
        contactInfoTitle: "Let's Talk About Your Project",
        contactInfoDesc: "I'm always available to discuss your project ideas and help you achieve them. Feel free to contact me through any of the following means.",
        emailTitle: "Email",
        phoneTitle: "Phone",
        locationTitle: "Location",
        location: "Cairo, Egypt",
        namePlaceholder: "Full Name",
        emailPlaceholder: "Email Address",
        subjectPlaceholder: "Subject",
        messagePlaceholder: "Message",
        sendMessage: "Send Message",

        // Footer
        footerText: "Professional Front-end Web engineer specialized in developing innovative and modern websites and web applications.",
        allRights: "All rights reserved"
    }
};

// ===== DOM ELEMENTS =====
const body = document.body;
const preloader = document.querySelector('.preloader');
const navbar = document.querySelector('.navbar');
const hamburger = document.querySelector('.hamburger');
const navMenu = document.querySelector('.nav-menu');
const langButtons = document.querySelectorAll('.toggle-btn[data-lang]');
const themeButtons = document.querySelectorAll('.toggle-btn[data-theme]');
const scrollToTopBtn = document.querySelector('.scroll-to-top');

// ===== INITIALIZATION =====
document.addEventListener('DOMContentLoaded', function() {
    initializeApp();
});

function initializeApp() {
    // Initialize preloader
    initPreloader();

    // Initialize navigation
    initNavigation();

    // Initialize language system
    initLanguageSystem();

    // Initialize theme system
    initThemeSystem();

    // Initialize animations
    initAnimations();

    // Initialize scroll effects
    initScrollEffects();

    // Initialize contact form
    initContactForm();
}

// ===== PRELOADER =====
function initPreloader() {
    window.addEventListener('load', function() {
        setTimeout(() => {
            preloader.classList.add('hidden');

            // Remove preloader from DOM after animation
            setTimeout(() => {
                preloader.style.display = 'none';
            }, 500);
        }, 1500);
    });
}

// ===== NAVIGATION =====
function initNavigation() {
    // Hamburger menu toggle
    hamburger.addEventListener('click', toggleMobileMenu);

    // Close mobile menu when clicking on links
    document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', () => {
            if (navMenu.classList.contains('active')) {
                toggleMobileMenu();
            }
        });
    });

    // Navbar background on scroll
    window.addEventListener('scroll', () => {
        if (window.scrollY > 100) {
            navbar.style.background = 'rgba(255, 255, 255, 0.98)';
            navbar.style.boxShadow = 'var(--shadow-lg)';

            if (body.classList.contains('dark-mode')) {
                navbar.style.background = 'rgba(15, 23, 42, 0.98)';
            }
        } else {
            navbar.style.background = 'rgba(255, 255, 255, 0.95)';
            navbar.style.boxShadow = 'var(--shadow-sm)';

            if (body.classList.contains('dark-mode')) {
                navbar.style.background = 'rgba(15, 23, 42, 0.95)';
            }
        }
    });
}

function toggleMobileMenu() {
    hamburger.classList.toggle('active');
    navMenu.classList.toggle('active');
}

// ===== LANGUAGE SYSTEM =====
function initLanguageSystem() {
    const savedLang = localStorage.getItem('portfolio-lang') || 'ar';
    setLanguage(savedLang);

    langButtons.forEach(button => {
        button.addEventListener('click', function() {
            const lang = this.getAttribute('data-lang');
            setLanguage(lang);
        });
    });
}

function setLanguage(lang) {
    // Update HTML direction and lang attribute
    document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
    document.documentElement.lang = lang;
    body.setAttribute('data-lang', lang);

    // Update active button state
    langButtons.forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-lang') === lang);
    });

    // Update all translatable elements
    updateTextContent(lang);

    // Save preference
    localStorage.setItem('portfolio-lang', lang);
}

function updateTextContent(lang) {
    const translation = translations[lang];

    // Update elements with data-key attribute
    document.querySelectorAll('[data-key]').forEach(element => {
        const key = element.getAttribute('data-key');
        if (translation[key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.setAttribute('placeholder', translation[key]);
            } else {
                element.innerHTML = translation[key];
            }
        }
    });

    // Update hero title with gradient text
    const heroTitle = document.querySelector('.hero-title .gradient-text');
    if (heroTitle && translation.name) {
        heroTitle.textContent = translation.name;
    }
}

// ===== THEME SYSTEM =====
function initThemeSystem() {
    const savedTheme = localStorage.getItem('portfolio-theme') || 'light';
    setTheme(savedTheme);

    themeButtons.forEach(button => {
        button.addEventListener('click', function() {
            const theme = this.getAttribute('data-theme');
            setTheme(theme);
        });
    });
}

function setTheme(theme) {
    // Update body class
    body.classList.remove('light-mode', 'dark-mode');
    body.classList.add(`${theme}-mode`);

    // Update active button state
    themeButtons.forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-theme') === theme);
    });

    // Update navbar background
    if (window.scrollY > 100) {
        navbar.style.background = theme === 'light' ?
            'rgba(255, 255, 255, 0.98)' :
            'rgba(15, 23, 42, 0.98)';
    }

    // Save preference
    localStorage.setItem('portfolio-theme', theme);
}

// ===== ANIMATIONS =====
function initAnimations() {
    // Initialize skill bars
    initSkillBars();

    // Initialize counter animation
    initCounters();

    // Initialize scroll animations
    initScrollAnimations();
}

function initSkillBars() {
    const skillItems = document.querySelectorAll('.skill-item');

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const skillItem = entry.target;
                const skillLevel = skillItem.getAttribute('data-skill');
                const skillProgress = skillItem.querySelector('.skill-progress');

                setTimeout(() => {
                    skillProgress.style.width = `${skillLevel}%`;
                }, 300);

                observer.unobserve(skillItem);
            }
        });
    }, { threshold: 0.5 });

    skillItems.forEach(item => observer.observe(item));
}

function initCounters() {
    const counters = document.querySelectorAll('[data-count]');

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                const counter = entry.target;
                const target = parseInt(counter.getAttribute('data-count'));
                const duration = 2000; // 2 seconds
                const step = target / (duration / 16); // 60fps
                let current = 0;

                const timer = setInterval(() => {
                    current += step;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    counter.textContent = Math.floor(current);
                }, 16);

                observer.unobserve(counter);
            }
        });
    }, { threshold: 0.5 });

    counters.forEach(counter => observer.observe(counter));
}

function initScrollAnimations() {
    const animatedElements = document.querySelectorAll('.hero-content, .hero-image, .about-image, .about-text, .skills-category, .project-card, .contact-info, .contact-form');

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.animationPlayState = 'running';
                observer.unobserve(entry.target);
            }
        });
    }, { threshold: 0.1 });

    animatedElements.forEach(el => {
        el.style.animationPlayState = 'paused';
        observer.observe(el);
    });
}

// ===== SCROLL EFFECTS =====
function initScrollEffects() {
    // Scroll to top button
    window.addEventListener('scroll', toggleScrollToTop);

    scrollToTopBtn.addEventListener('click', scrollToTop);

    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();

            const targetId = this.getAttribute('href');
            if (targetId === '#') return;

            const targetElement = document.querySelector(targetId);
            if (targetElement) {
                const offsetTop = targetElement.offsetTop - 80;

                window.scrollTo({
                    top: offsetTop,
                    behavior: 'smooth'
                });
            }
        });
    });
}

function toggleScrollToTop() {
    if (window.scrollY > 300) {
        scrollToTopBtn.classList.add('visible');
    } else {
        scrollToTopBtn.classList.remove('visible');
    }
}

function scrollToTop() {
    window.scrollTo({
        top: 0,
        behavior: 'smooth'
    });
}

// ===== CONTACT FORM =====
function initContactForm() {
    const contactForm = document.querySelector('.contact-form');

    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();

            // Get form data
            const formData = new FormData(this);
            const name = this.querySelector('input[type="text"]').value;
            const email = this.querySelector('input[type="email"]').value;
            const subject = this.querySelectorAll('input[type="text"]')[1].value;
            const message = this.querySelector('textarea').value;

            // Simple validation
            if (!name || !email || !subject || !message) {
                showNotification('Please fill in all fields', 'error');
                return;
            }

            // Simulate form submission
            const submitBtn = this.querySelector('.submit-btn');
            const originalText = submitBtn.innerHTML;

            submitBtn.innerHTML = `
                <span>${body.getAttribute('data-lang') === 'ar' ? 'جاري الإرسال...' : 'Sending...'}</span>
                <i class="fas fa-spinner fa-spin"></i>
            `;
            submitBtn.disabled = true;

            setTimeout(() => {
                showNotification(
                    body.getAttribute('data-lang') === 'ar' ?
                    'تم إرسال رسالتك بنجاح!' :
                    'Your message has been sent successfully!',
                    'success'
                );

                // Reset form
                this.reset();
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 2000);
        });
    }
}

function showNotification(message, type) {
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            <span>${message}</span>
        </div>
    `;

    // Add styles
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: ${type === 'success' ? 'var(--success)' : 'var(--error)'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-xl);
        z-index: 10000;
        transform: translateX(400px);
        transition: transform 0.3s ease;
        max-width: 400px;
    `;

    document.body.appendChild(notification);

    // Animate in
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);

    // Remove after 5 seconds
    setTimeout(() => {
        notification.style.transform = 'translateX(400px)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 5000);
}

// ===== ADDITIONAL ENHANCEMENTS =====
// Parallax effect for floating elements
window.addEventListener('scroll', () => {
    const scrolled = window.pageYOffset;
    const parallaxElements = document.querySelectorAll('.float-circle, .float-square');

    parallaxElements.forEach(element => {
        const speed = element.classList.contains('float-circle') ? 0.5 : 0.3;
        element.style.transform = `translateY(${scrolled * speed}px)`;
    });
});

// Typing effect for hero title (optional enhancement)
function initTypingEffect() {
    const heroTitle = document.querySelector('.hero-title .gradient-text');
    if (!heroTitle) return;

    const text = heroTitle.textContent;
    heroTitle.textContent = '';

    let i = 0;
    const timer = setInterval(() => {
        if (i < text.length) {
            heroTitle.textContent += text.charAt(i);
            i++;
        } else {
            clearInterval(timer);
        }
    }, 100);
}

// Initialize typing effect when hero section is in view
const heroObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            initTypingEffect();
            heroObserver.unobserve(entry.target);
        }
    });
}, { threshold: 0.5 });

const heroSection = document.querySelector('.hero');
if (heroSection) {
    heroObserver.observe(heroSection);
}

// ===== تحميل المشاريع من Dashboard =====
function loadPortfolioProjects() {
    const projects = localStorage.getItem('portfolio-projects');
    const projectsGrid = document.querySelector('.projects-grid');
    
    // إذا لم تكن هناك مشاريع محفوظة، اترك المحتوى الأصلي
    if (!projects || !projectsGrid) {
        return;
    }
    
    const projectsData = JSON.parse(projects);
    const currentLang = document.body.getAttribute('data-lang') || 'ar';
    
    // فقط إذا كانت هناك مشاريع محفوظة، استبدل المحتوى
    if (projectsData.length > 0) {
        projectsGrid.innerHTML = projectsData.map(project => {
            // خلفية بسيطة
            const projectBg = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            
            // أيقونة بسيطة
            const projectIcon = '<i class="fas fa-code" style="font-size: 3rem; color: white;"></i>';
            
            // إنشاء أزرار الروابط المتاحة فقط
            let linksHtml = '';
            if (project.links.youtube) {
                linksHtml += `<a href="${project.links.youtube}" class="project-link" target="_blank" style="background: #ff0000; color: white;" title="YouTube Video">
                    <i class="fab fa-youtube"></i>
                </a>`;
            }
            if (project.links.github) {
                linksHtml += `<a href="${project.links.github}" class="project-link" target="_blank" style="background: #333; color: white;" title="GitHub Repository">
                    <i class="fab fa-github"></i>
                </a>`;
            }
            if (project.links.live) {
                linksHtml += `<a href="${project.links.live}" class="project-link" target="_blank" style="background: #007bff; color: white;" title="Live Demo">
                    <i class="fas fa-external-link-alt"></i>
                </a>`;
            }
            
            return `
                <div class="project-card">
                    <div class="project-image">
                        <div class="project-thumbnail" style="width: 100%; height: 200px; background: ${projectBg}; display: flex; align-items: center; justify-content: center; position: relative;">
                            ${projectIcon}
                        </div>
                        <div class="project-overlay">
                            <div class="project-links">
                                ${linksHtml}
                            </div>
                        </div>
                        <div class="project-badge">${project.badge}</div>
                    </div>
                    <div class="project-info">
                        <h3 class="project-title">${project.title[currentLang]}</h3>
                        <p class="project-description">${project.description[currentLang]}</p>
                        <div class="project-tech">
                            ${project.techs.map(tech => `<span class="tech-tag">${tech}</span>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }).join('');
        
        // إضافة event listeners للفيديو
        addVideoListeners();
    }
}

// إضافة event listeners للفيديو
function addVideoListeners() {
    const videoLinks = document.querySelectorAll('.video-link');
    videoLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const videoUrl = this.getAttribute('data-video');
            const title = this.getAttribute('data-title');
            openVideoModal(videoUrl, title);
        });
    });
}

// فتح نافذة الفيديو
function openVideoModal(videoUrl, title) {
    // إنشاء modal للفيديو
    const modal = document.createElement('div');
    modal.className = 'video-modal';
    modal.innerHTML = `
        <div class="video-modal-content">
            <div class="video-modal-header">
                <h3>${title}</h3>
                <button class="video-modal-close">&times;</button>
            </div>
            <div class="video-modal-body">
                <video controls style="width: 100%; max-width: 800px;">
                    <source src="${videoUrl}" type="video/mp4">
                    <source src="${videoUrl}" type="video/webm">
                    <source src="${videoUrl}" type="video/ogg">
                    متصفحك لا يدعم تشغيل الفيديو.
                </video>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // إغلاق modal
    const closeBtn = modal.querySelector('.video-modal-close');
    closeBtn.addEventListener('click', () => {
        document.body.removeChild(modal);
    });
    
    // إغلاق عند الضغط خارج الفيديو
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            document.body.removeChild(modal);
        }
    });
}

// تحميل المشاريع عند فتح الصفحة وعند تغيير اللغة
document.addEventListener('DOMContentLoaded', function() {
    // تأكد من تحميل الصفحة أولاً
    setTimeout(loadPortfolioProjects, 100);
});

// تحميل المشاريع عند فتح الصفحة
window.addEventListener('load', function() {
    setTimeout(loadPortfolioProjects, 200);
});

// إعادة تحميل المشاريع عند تغيير اللغة
const originalSetLanguage = setLanguage;
setLanguage = function(lang) {
    originalSetLanguage(lang);
    setTimeout(loadPortfolioProjects, 100);
};